<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Space Defender</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #000;
            overflow: hidden;
            touch-action: none;
            font-family: 'Courier New', monospace;
        }
        canvas {
            display: block;
            margin: 0 auto;
        }
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #0f0;
            font-size: 16px;
            z-index: 10;
            text-shadow: 0 0 5px #0f0;
        }
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #f00;
            font-size: 32px;
            text-align: center;
            display: none;
            text-shadow: 0 0 10px #f00;
        }
        #gameOver button {
            margin-top: 20px;
            padding: 15px 30px;
            font-size: 18px;
            background: #0f0;
            border: none;
            cursor: pointer;
            font-family: inherit;
        }
        #startScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #0f0;
            font-size: 24px;
            text-align: center;
            text-shadow: 0 0 10px #0f0;
        }
        #startScreen button {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 20px;
            background: #0f0;
            border: none;
            cursor: pointer;
            font-family: inherit;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div>SCORE: <span id="score">0</span></div>
        <div>LIVES: <span id="lives">3</span></div>
        <div>LEVEL: <span id="level">1</span></div>
    </div>
    <div id="startScreen">
        <div>ðŸš€ SPACE DEFENDER ðŸš€</div>
        <div style="font-size: 14px; margin-top: 10px;">Tap left/right to move â€¢ Tap to shoot</div>
        <button onclick="startGame()">START</button>
    </div>
    <div id="gameOver">
        <div>GAME OVER</div>
        <div style="font-size: 18px; margin-top: 10px;">Final Score: <span id="finalScore">0</span></div>
        <button onclick="restartGame()">PLAY AGAIN</button>
    </div>
    <canvas id="game"></canvas>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        
        // Responsive canvas
        function resize() {
            canvas.width = Math.min(window.innerWidth, 600);
            canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);
        
        // Game state
        let gameRunning = false;
        let score = 0;
        let lives = 3;
        let level = 1;
        let player, bullets, enemies, enemyBullets, particles;
        let lastShot = 0;
        let touchStartX = null;
        
        // Player
        const playerObj = {
            x: canvas.width / 2,
            y: canvas.height - 60,
            width: 40,
            height: 30,
            speed: 8,
            color: '#0f0'
        };
        
        // Initialize game
        function init() {
            player = { ...playerObj, x: canvas.width / 2 };
            bullets = [];
            enemies = [];
            enemyBullets = [];
            particles = [];
            
            // Create enemies
            const cols = 8;
            const rows = 4;
            const enemyWidth = 30;
            const enemyHeight = 20;
            const padding = 15;
            const offsetTop = 80;
            const offsetLeft = (canvas.width - (cols * (enemyWidth + padding))) / 2;
            
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    enemies.push({
                        x: offsetLeft + c * (enemyWidth + padding),
                        y: offsetTop + r * (enemyHeight + padding),
                        width: enemyWidth,
                        height: enemyHeight,
                        color: r === 0 ? '#f0f' : r === 1 ? '#ff0' : r === 2 ? '#0ff' : '#f00'
                    });
                }
            }
            
            // Enemy direction
            enemyDir = 1;
            enemySpeed = 1 + level * 0.3;
        }
        
        let enemyDir = 1;
        let enemySpeed = 1;
        
        // Input handling
        let keys = {};
        document.addEventListener('keydown', e => keys[e.code] = true);
        document.addEventListener('keyup', e => keys[e.code] = false);
        
        // Touch controls
        canvas.addEventListener('touchstart', e => {
            e.preventDefault();
            touchStartX = e.touches[0].clientX;
            shoot();
        });
        canvas.addEventListener('touchmove', e => {
            e.preventDefault();
            if (touchStartX !== null) {
                const diff = e.touches[0].clientX - touchStartX;
                if (Math.abs(diff) > 10) {
                    player.x += diff > 0 ? player.speed : -player.speed;
                    touchStartX = e.touches[0].clientX;
                }
            }
            player.x = Math.max(player.width/2, Math.min(canvas.width - player.width/2, player.x));
        });
        canvas.addEventListener('touchend', e => {
            touchStartX = null;
        });
        
        function shoot() {
            const now = Date.now();
            if (now - lastShot > 250) {
                bullets.push({
                    x: player.x,
                    y: player.y - 20,
                    width: 4,
                    height: 15,
                    speed: 10,
                    color: '#0f0'
                });
                lastShot = now;
            }
        }
        
        function enemyShoot() {
            if (enemies.length > 0 && Math.random() < 0.02 + level * 0.005) {
                const enemy = enemies[Math.floor(Math.random() * enemies.length)];
                enemyBullets.push({
                    x: enemy.x + enemy.width / 2,
                    y: enemy.y + enemy.height,
                    width: 4,
                    height: 10,
                    speed: 4 + level * 0.5,
                    color: '#f00'
                });
            }
        }
        
        function createExplosion(x, y, color) {
            for (let i = 0; i < 10; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8,
                    life: 30,
                    color: color
                });
            }
        }
        
        function update() {
            if (!gameRunning) return;
            
            // Player movement
            if (keys['ArrowLeft'] || keys['KeyA']) player.x -= player.speed;
            if (keys['ArrowRight'] || keys['KeyD']) player.x += player.speed;
            player.x = Math.max(player.width/2, Math.min(canvas.width - player.width/2, player.x));
            
            // Auto shoot in mobile
            if ('ontouchstart' in window) {
                shoot();
            }
            
            // Update bullets
            bullets = bullets.filter(b => {
                b.y -= b.speed;
                return b.y > -20;
            });
            
            // Update enemy bullets
            enemyBullets = enemyBullets.filter(b => {
                b.y += b.speed;
                
                // Collision with player
                if (Math.abs(b.x - player.x) < player.width/2 && 
                    Math.abs(b.y - player.y) < player.height/2) {
                    lives--;
                    createExplosion(player.x, player.y, '#0f0');
                    updateUI();
                    if (lives <= 0) gameOver();
                    return false;
                }
                
                return b.y < canvas.height + 20;
            });
            
            // Move enemies
            let hitEdge = false;
            enemies.forEach(e => {
                e.x += enemyDir * enemySpeed;
                if (e.x <= 0 || e.x + e.width >= canvas.width) hitEdge = true;
            });
            
            if (hitEdge) {
                enemyDir *= -1;
                enemies.forEach(e => e.y += 20);
            }
            
            // Enemy shoot
            enemyShoot();
            
            // Bullet-enemy collision
            bullets.forEach((b, bi) => {
                enemies.forEach((e, ei) => {
                    if (b.x > e.x && b.x < e.x + e.width &&
                        b.y > e.y && b.y < e.y + e.height) {
                        createExplosion(e.x + e.width/2, e.y + e.height/2, e.color);
                        enemies.splice(ei, 1);
                        bullets.splice(bi, 1);
                        score += 10 * level;
                        updateUI();
                    }
                });
            });
            
            // Check if enemies reached bottom
            enemies.forEach(e => {
                if (e.y + e.height >= player.y - 20) {
                    lives = 0;
                    updateUI();
                    gameOver();
                }
            });
            
            // Level complete
            if (enemies.length === 0) {
                level++;
                enemySpeed = 1 + level * 0.3;
                init();
                updateUI();
            }
            
            // Update particles
            particles = particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                return p.life > 0;
            });
        }
        
        function draw() {
            // Clear
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Stars
            ctx.fillStyle = '#fff';
            for (let i = 0; i < 50; i++) {
                const x = (i * 137 + Date.now() * 0.01) % canvas.width;
                const y = (i * 73) % canvas.height;
                ctx.fillRect(x, y, 1, 1);
            }
            
            if (!gameRunning) return;
            
            // Draw player (spaceship)
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.moveTo(player.x, player.y - 15);
            ctx.lineTo(player.x - 20, player.y + 15);
            ctx.lineTo(player.x - 8, player.y + 5);
            ctx.lineTo(player.x + 8, player.y + 5);
            ctx.lineTo(player.x + 20, player.y + 15);
            ctx.closePath();
            ctx.fill();
            
            // Draw bullets
            bullets.forEach(b => {
                ctx.fillStyle = b.color;
                ctx.fillRect(b.x - b.width/2, b.y, b.width, b.height);
            });
            
            // Draw enemies
            enemies.forEach(e => {
                ctx.fillStyle = e.color;
                // Alien shape
                ctx.fillRect(e.x + 5, e.y, e.width - 10, e.height - 5);
                ctx.fillRect(e.x, e.y + 5, e.width, e.height - 10);
                // Eyes
                ctx.fillStyle = '#000';
                ctx.fillRect(e.x + 8, e.y + 6, 4, 4);
                ctx.fillRect(e.x + e.width - 12, e.y + 6, 4, 4);
            });
            
            // Draw enemy bullets
            enemyBullets.forEach(b => {
                ctx.fillStyle = b.color;
                ctx.fillRect(b.x - b.width/2, b.y, b.width, b.height);
            });
            
            // Draw particles
            particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life / 30;
                ctx.fillRect(p.x, p.y, 3, 3);
                ctx.globalAlpha = 1;
            });
        }
        
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('lives').textContent = lives;
            document.getElementById('level').textContent = level;
        }
        
        function gameOver() {
            gameRunning = false;
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOver').style.display = 'block';
        }
        
        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            score = 0;
            lives = 3;
            level = 1;
            init();
            gameRunning = true;
            updateUI();
            gameLoop();
        }
        
        function restartGame() {
            document.getElementById('gameOver').style.display = 'none';
            startGame();
        }
        
        function gameLoop() {
            if (gameRunning) {
                update();
                draw();
                requestAnimationFrame(gameLoop);
            }
        }
        
        // Initial draw
        draw();
    </script>
</body>
</html>
